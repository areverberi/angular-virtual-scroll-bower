/* angular-virtual-scroll - v0.3.0 - 2013-03-17 */ (function(){"use strict";angular.module("sf.virtualScroll",[])})(),function(){"use strict";var t=angular.module("sf.virtualScroll");t.filter("sublist",function(){return function(t,e,r){return t.slice(r,r+e)}})}(),function(){"use strict";var t=angular.module("sf.virtualScroll");t.directive("sfScroller",function(){function t(t){var e=t.match(/^(x|y)\s*(=|in)\s*(.+) to (.+)$/);if(!e)throw Error("Expected sfScroller in form of '_axis_ in _lower_ to _upper_' but got '"+t+"'.");return{axis:e[1],lower:e[3],upper:e[4]}}var e=18;return function(r,o,n){var i=t(n.sfScroller),a=r.$eval(i.lower),l=r.$eval(i.upper),c="x"===i.axis;o.css({height:c?"1em":"100%",width:c?"100%":"1em","overflow-x":c?"scroll":"hidden","overflow-y":c?"hidden":"scroll",position:"absolute",top:c?"100%":0,right:0}).parent().css({position:"relative"});var s=angular.element("<div></div>");o.append(s),o.bind("scroll",function(){var t=o.prop("scrollTop");n.ngModel&&r.$apply(n.ngModel+" = "+t/e)}),r.$watch(i.lower,function(t){a=t,s.css("height",(l-a)*e+"px")}),r.$watch(i.upper,function(t){l=t,s.css("height",(l-a)*e+"px")}),r.$watch(n.ngModel,function(t){var r=t*e;o.prop("scrollTop")!==r&&o.prop("scrollTop".scrollTop)})}})}(),function(){"use strict";var t=angular.module("sf.virtualScroll");t.directive("sfVirtualRepeat",["$log",function(t){function e(t){var e=t.match(/^\s*([\$\w]+)\s+in\s+(\S*)\s*$/);if(!e)throw Error("Expected sfVirtualRepeat in form of '_item_ in _collection_' but got '"+t+"'.");return{value:e[1],collection:e[2]}}function r(t){var e={overflow:"auto"},r=window.getComputedStyle?window.getComputedStyle(t[0]):t[0].currentStyle,o=r&&r.getPropertyValue("max-height"),n=r&&r.getPropertyValue("height");o&&"0px"!==o?e.maxHeight=o:e.height=n&&"0px"!==n?n:window.innerHeight,t.css(e)}function o(t){var e={overflow:"hidden",width:"auto",margin:0,padding:0,border:0,"box-sizing":"border-box"};t.css(e)}function n(e){var r=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,o=r&&r.getPropertyValue("max-height"),n=r&&r.getPropertyValue("height");if(n&&"0px"!==n)t.info('Row height is "%s" from css height',n);else if(o&&"0px"!==o)n=o,t.info('Row height is "%s" from css max-height',n);else{if(!e[0].clientHeight)throw Error("Unable to compute height of row");n=e.clientHeight+"px",t.info('Row height is "%s" from client height',n)}return angular.element(e).css("height",n),parseInt(n,10)}function i(i,a,l){function c(e,i){function a(t){var e={display:"block",margin:"0"};x&&(e.height=x+"px"),t.css(e)}function c(t,e,r){var o=r.$new();return o[s.value]=m[t],o.$index=t,o.$first=0===t,o.$last=t===m.length-1,o.$middle=!(o.$first||o.$last),o.$watch(function(){o[s.value]=m[t]}),o}function h(t,e,r,o,n){var i,s,u,f=document.createDocumentFragment(),h=[];for(s=t;s!==e;s++)u=c(s,r,o),i=l(u,angular.noop),a(i),h.push(i),f.appendChild(i[0]);return n.after(f),h}function p(r){var o,n=r.target.scrollTop,i=Math.floor(n/x),a=Math.max(0,Math.min(i-u,Math.max(i-f,y.start)));$=Math.ceil(S[0].clientHeight/x),o=Math.min(y.len,Math.max(i+$+u,Math.min(i+$+f,y.start+y.active))),t.log("scroll to row %d (show %d - %d)",i,a,o),e.$apply(function(){y={start:a,active:o-a,len:y.len}})}function d(){return m=e.$eval(s.collection),m.length!==y.len&&(y={start:y.start,active:y.active,len:m.length}),y}function g(t,e){var r,o,n=Array.prototype[t];for(o=0;e>o;o++)r=n.call(w),r.scope().$destroy(),r.remove()}function v(e,r,o){var a,l=r.start+r.active,c=o.$eval(s.collection);if(e===r)t.info("initial listen"),a=h(e.start,l,c,o,i),w=a,x=n(a[0][0]);else{var u=e.start+e.active,f=e.start>r.start,p=f?e.start-r.start:r.start-e.start,d=u>=l?u-l:l-u,v=(f?r.active:e.active)>p;if(t.info("change by %d,%d rows %s",p,d,f?"forward":"backward"),v){if(f?(t.info("need to remove from the top"),g("shift",p)):p&&(t.info("need to add at the top"),a=h(e.start,r.start,c,o,i),w=a.concat(w)),l>u)t.info("need to remove from the bottom"),g("pop",l-u);else if(d){var m=w[w.length-1];t.info("need to add to the bottom"),a=h(l,u,c,o,m),w=w.concat(a)}}else t.info("non-contiguous change"),g("pop",w.length),w=h(e.start,u,c,o,i);b.css({"padding-top":e.start*x+"px"})}b.css({height:e.len*x+"px"})}var m=e.$eval(s.collection),w=[],x=0,$=0,y={start:0,active:20,len:m.length},b=i.parent(),S=b.parent();o(b),r(S),S.bind("scroll",p),e.$watch(d,v)}var s=e(a.sfVirtualRepeat),u=100,f=200;return{post:c}}return{transclude:"element",priority:1e3,terminal:!0,compile:i}}])}();