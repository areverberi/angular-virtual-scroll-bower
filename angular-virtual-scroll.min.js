/* angular-virtual-scroll - v0.4.0 - 2013-05-11 */ (function(){"use strict";angular.module("sf.virtualScroll",[])})(),function(){"use strict";var t=angular.module("sf.virtualScroll");t.filter("sublist",function(){return function(t,e,r){return t.slice(r,r+e)}})}(),function(){"use strict";var t=angular.module("sf.virtualScroll");t.directive("sfScroller",function(){function t(t){var e=t.match(/^(x|y)\s*(=|in)\s*(.+) to (.+)$/);if(!e)throw Error("Expected sfScroller in form of '_axis_ in _lower_ to _upper_' but got '"+t+"'.");return{axis:e[1],lower:e[3],upper:e[4]}}var e=18;return function(r,i,o){var n=t(o.sfScroller),l=r.$eval(n.lower),a=r.$eval(n.upper),s="x"===n.axis;i.css({height:s?"1em":"100%",width:s?"100%":"1em","overflow-x":s?"scroll":"hidden","overflow-y":s?"hidden":"scroll",position:"absolute",top:s?"100%":0,right:0}).parent().css({position:"relative"});var c=angular.element("<div></div>");i.append(c),i.bind("scroll",function(){var t=i.prop("scrollTop");o.ngModel&&r.$apply(o.ngModel+" = "+t/e)}),r.$watch(n.lower,function(t){l=t,c.css("height",(a-l)*e+"px")}),r.$watch(n.upper,function(t){a=t,c.css("height",(a-l)*e+"px")}),r.$watch(o.ngModel,function(t){var r=t*e;i.prop("scrollTop")!==r&&i.prop("scrollTop".scrollTop)})}})}(),function(){"use strict";function t(e,r,i){return angular.isArray(e)?angular.forEach(e,function(e){return t(e,r,i)}):Math.max(r,Math.min(e,i))}var e=angular.module("sf.virtualScroll"),r=["TABLE","TBODY","THEAD","TR","TFOOT"];e.directive("sfVirtualRepeat",["$log","$rootElement",function(e,i){function o(t){var e=t.match(/^\s*([\$\w]+)\s+in\s+(\S*)\s*$/);if(!e)throw Error("Expected sfVirtualRepeat in form of '_item_ in _collection_' but got '"+t+"'.");return{value:e[1],collection:e[2]}}function n(t){var e,o,n,l,a=i[0];for(e=t.parent().parent()[0];e!==a&&1==e.nodeType;e=e.parentNode){for(l=e.tagName.toUpperCase(),n=0;r.length>n&&r[n]!==l;n++);if(!(r.length>n)&&1==e.childElementCount){for(o=e.firstChild;o&&(3!=o.nodeType||!/\S/g.test(o.textContent));o=o.nextSibling);if(null==o)return angular.element(e)}}throw Error("No suitable viewport element")}function l(t){var e={overflow:"auto"},r=window.getComputedStyle?window.getComputedStyle(t[0]):t[0].currentStyle,i=r&&r.getPropertyValue("max-height"),o=r&&r.getPropertyValue("height");i&&"0px"!==i?e.maxHeight=i:e.height=o&&"0px"!==o?o:window.innerHeight,t.css(e)}function a(t){var e={width:"auto",margin:0,padding:0,border:0,"box-sizing":"border-box"};t.css(e)}function s(t){var r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,i=r&&r.getPropertyValue("max-height"),o=r&&r.getPropertyValue("height");if(o&&"0px"!==o)e.info('Row height is "%s" from css height',o);else if(i&&"0px"!==i)o=i,e.info('Row height is "%s" from css max-height',o);else{if(!t[0].clientHeight)throw Error("Unable to compute height of row");o=t.clientHeight+"px",e.info('Row height is "%s" from client height',o)}return angular.element(t).css("height",o),parseInt(o,10)}function c(r,i,c){function u(r,i,o){function u(t){var e={display:"block",margin:"0"};S&&(e.height=S+"px"),t.css(e)}function p(t,e,r){var i=r.$new();return i[f.value]=e[t],i.$index=t,i.$first=0===t,i.$last=t===e.length-1,i.$middle=!(i.$first||i.$last),i.$watch(function(){i[f.value]=e[t]}),i}function v(t,e,r,i,o){var n,l,a,s=document.createDocumentFragment(),f=[];for(l=t;l!==e;l++)a=p(l,r,i),n=c(a,angular.noop),u(n),f.push(n),s.appendChild(n[0]);return o.after(s),f}function d(){var e=t($.firstActive,$.firstVisible-h,$.firstVisible-g),r=t($.firstActive+$.active,$.firstVisible+$.visible+h,$.firstVisible+$.visible+g);$.firstActive=Math.max(0,e),$.active=Math.min(r,$.total)-$.firstActive}function m(t){S&&r.$apply(function(){$.firstVisible=Math.floor(t.target.scrollTop/S),$.visible=Math.ceil(V[0].clientHeight/S),e.log("scroll to row %o",$.firstVisible),T=t.target.scrollTop+t.target.clientHeight>=t.target.scrollHeight,d(),e.log(" state is now %o",$),e.log(" sticky = %o",T)})}function w(t){var e=t.$eval(f.collection);return e.length!==$.total&&($.total=e.length,d()),{start:$.firstActive,active:$.active,len:e.length}}function b(t,e){var r,i,o=Array.prototype[t];for(i=0;e>i;i++)r=o.call(y),r.scope().$destroy(),r.remove()}function x(t,r,o){var n,l=r.start+r.active,a=o.$eval(f.collection);if(t===r)e.info("initial listen"),n=v(t.start,l,a,o,i),y=n,y.length&&(S=s(n[0][0]));else{var c=t.start+t.active,u=t.start>=r.start,h=u?t.start-r.start:r.start-t.start,g=c>=l?c-l:l-c,p=(u?r.active:t.active)>h;if(e.info("change by %o,%o rows %s",h,g,u?"forward":"backward"),p){if(u?(e.info("need to remove from the top"),b("shift",h)):h&&(e.info("need to add at the top"),n=v(t.start,r.start,a,o,i),y=n.concat(y)),l>c)e.info("need to remove from the bottom"),b("pop",l-c);else if(g){var d=y[y.length-1];e.info("need to add to the bottom"),n=v(l,c,a,o,d),y=y.concat(n)}}else e.info("non-contiguous change"),b("pop",y.length),y=v(t.start,c,a,o,i);!S&&y.length&&(S=s(y[0][0])),M.css({"padding-top":t.start*S+"px"})}M.css({height:t.len*S+"px"}),T&&(V[0].scrollTop=V[0].clientHeight+V[0].scrollHeight)}var $="ngModel"in o?r.$eval(o.ngModel):{},y=[],S=0,T=!1,V=n(i),M=V.children();$.firstActive=0,$.firstVisible=0,$.visible=0,$.active=0,$.total=0,a(M),l(V),V.bind("scroll",m),r.$watch(w,x,!0)}var f=o(i.sfVirtualRepeat),h=100,g=200;return{post:u}}return{require:"?ngModel",transclude:"element",priority:1e3,terminal:!0,compile:c}}])}();