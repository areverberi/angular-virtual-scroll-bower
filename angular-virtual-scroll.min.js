/* angular-virtual-scroll - v0.3.1 - 2013-04-14 */ (function(){"use strict";angular.module("sf.virtualScroll",[])})(),function(){"use strict";var t=angular.module("sf.virtualScroll");t.filter("sublist",function(){return function(t,e,o){return t.slice(o,o+e)}})}(),function(){"use strict";var t=angular.module("sf.virtualScroll");t.directive("sfScroller",function(){function t(t){var e=t.match(/^(x|y)\s*(=|in)\s*(.+) to (.+)$/);if(!e)throw Error("Expected sfScroller in form of '_axis_ in _lower_ to _upper_' but got '"+t+"'.");return{axis:e[1],lower:e[3],upper:e[4]}}var e=18;return function(o,r,i){var n=t(i.sfScroller),a=o.$eval(n.lower),l=o.$eval(n.upper),c="x"===n.axis;r.css({height:c?"1em":"100%",width:c?"100%":"1em","overflow-x":c?"scroll":"hidden","overflow-y":c?"hidden":"scroll",position:"absolute",top:c?"100%":0,right:0}).parent().css({position:"relative"});var s=angular.element("<div></div>");r.append(s),r.bind("scroll",function(){var t=r.prop("scrollTop");i.ngModel&&o.$apply(i.ngModel+" = "+t/e)}),o.$watch(n.lower,function(t){a=t,s.css("height",(l-a)*e+"px")}),o.$watch(n.upper,function(t){l=t,s.css("height",(l-a)*e+"px")}),o.$watch(i.ngModel,function(t){var o=t*e;r.prop("scrollTop")!==o&&r.prop("scrollTop".scrollTop)})}})}(),function(){"use strict";var t=angular.module("sf.virtualScroll");t.directive("sfVirtualRepeat",["$log",function(t){function e(t){var e=t.match(/^\s*([\$\w]+)\s+in\s+(\S*)\s*$/);if(!e)throw Error("Expected sfVirtualRepeat in form of '_item_ in _collection_' but got '"+t+"'.");return{value:e[1],collection:e[2]}}function o(t){var e={overflow:"auto"},o=window.getComputedStyle?window.getComputedStyle(t[0]):t[0].currentStyle,r=o&&o.getPropertyValue("max-height"),i=o&&o.getPropertyValue("height");r&&"0px"!==r?e.maxHeight=r:e.height=i&&"0px"!==i?i:window.innerHeight,t.css(e)}function r(t){var e={width:"auto",margin:0,padding:0,border:0,"box-sizing":"border-box"};t.css(e)}function i(e){var o=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,r=o&&o.getPropertyValue("max-height"),i=o&&o.getPropertyValue("height");if(i&&"0px"!==i)t.info('Row height is "%s" from css height',i);else if(r&&"0px"!==r)i=r,t.info('Row height is "%s" from css max-height',i);else{if(!e[0].clientHeight)throw Error("Unable to compute height of row");i=e.clientHeight+"px",t.info('Row height is "%s" from client height',i)}return angular.element(e).css("height",i),parseInt(i,10)}function n(n,a,l){function c(e,n){function a(t){var e={display:"block",margin:"0"};x&&(e.height=x+"px"),t.css(e)}function c(t,e,o){var r=o.$new();return r[s.value]=m[t],r.$index=t,r.$first=0===t,r.$last=t===m.length-1,r.$middle=!(r.$first||r.$last),r.$watch(function(){r[s.value]=m[t]}),r}function f(t,e,o,r,i){var n,s,u,h=document.createDocumentFragment(),f=[];for(s=t;s!==e;s++)u=c(s,o,r),n=l(u,angular.noop),a(n),f.push(n),h.appendChild(n[0]);return i.after(h),f}function p(o){var r,i=o.target.scrollTop,n=Math.floor(i/x),a=Math.max(0,Math.min(n-u,Math.max(n-h,y.start)));$=Math.ceil(M[0].clientHeight/x),r=Math.min(y.len,Math.max(n+$+u,Math.min(n+$+h,y.start+y.active))),t.log("scroll to row %o (show %o - %o)",n,a,r),e.$apply(function(){b=o.target.scrollTop+o.target.clientHeight>=o.target.scrollHeight,y={start:a,active:r-a,len:y.len},t.log("active is now %o",y),t.log("sticky = %o",b)})}function g(){return m=e.$eval(s.collection),m.length!==y.len&&(y={start:y.start,active:y.active,len:m.length}),y}function d(t,e){var o,r,i=Array.prototype[t];for(r=0;e>r;r++)o=i.call(w),o.scope().$destroy(),o.remove()}function v(e,o,r){var a,l=o.start+o.active,c=r.$eval(s.collection);if(e===o)t.info("initial listen"),a=f(e.start,l,c,r,n),w=a,x=i(a[0][0]);else{var u=e.start+e.active,h=e.start>o.start,p=h?e.start-o.start:o.start-e.start,g=u>=l?u-l:l-u,v=(h?o.active:e.active)>p;if(t.info("change by %o,%o rows %s",p,g,h?"forward":"backward"),v){if(h?(t.info("need to remove from the top"),d("shift",p)):p&&(t.info("need to add at the top"),a=f(e.start,o.start,c,r,n),w=a.concat(w)),l>u)t.info("need to remove from the bottom"),d("pop",l-u);else if(g){var m=w[w.length-1];t.info("need to add to the bottom"),a=f(l,u,c,r,m),w=w.concat(a)}}else t.info("non-contiguous change"),d("pop",w.length),w=f(e.start,u,c,r,n);S.css({"padding-top":e.start*x+"px"})}S.css({height:e.len*x+"px"}),b&&(M[0].scrollTop=M[0].clientHeight+M[0].scrollHeight)}var m=e.$eval(s.collection),w=[],x=0,$=0,y={start:0,active:20,len:m.length},b=!1,S=n.parent(),M=S.parent();r(S),o(M),M.bind("scroll",p),e.$watch(g,v)}var s=e(a.sfVirtualRepeat),u=100,h=200;return{post:c}}return{transclude:"element",priority:1e3,terminal:!0,compile:n}}])}();